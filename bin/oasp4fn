#!/usr/bin/env node

'use strict';

let yml_gen = require('../out/yml-generator/index');
let fs = require('fs');
let _ = require('lodash');

function logError(msg) {
    if(msg) {
        console.log(msg)
    }
    else {
        console.log("help")
    }
}

function oasp4fn() {
    console.log(process.argv)
    if(process.argv.length > 2) {
        let args = _.slice(process.argv, 2)
        let opts = {}
        let config_file = "oasp4fn.config.js"
        try {
            _.some(args, (arg, i, list) => {
                console.log(arg)
                if(arg){
                    switch(arg) {
                        case 'aws':
                            console.log('aws')
                            break;
                        case '--opts':
                        case '-o':
                            console.log('opts')
                            _.set(opts, 'config', _.remove(list, (value, j) => {
                                return j === (i + 1)
                            })[0])
                            break;
                        case '--path':
                        case '-p':
                            console.log('path')
                            _.set(opts, 'path', _.remove(list, (value, j) => {
                                return j === (i + 1)
                            })[0])
                            break;
                        case '--help':
                        case '-h':
                            console.log('help')
                            throw false
                        default:
                            console.log('default')
                            throw `The argument "${arg}" isn't valid. Please, for more information, run "oasp4fn --help"`;
                    }
                }
                return false
            })
            if(opts.config) {
                if(fs.existsSync(opts.config)) {
                    _.assign(opts, require(opts.config))
                }
                else
                    `The options file "${opts.config}" doesn't exist.`
            }
            else if (fs.existsSync("oasp4fn.config.js")) {
                _.assign(opts, require("oasp4fn.config.js"))
            }
            _.isEmpty(opts) ? yml_gen.run() : yml_gen.run(opts);

        } catch(e) {
            logError(e)
        }
    }
    else
       yml_gen.run(); 
}

oasp4fn()